{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <!-- FullCalendar JS -->
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
     <!-- JavaScript ì—°ê²° -->
    <script src="{% static 'js/script.js' %}"></script>
    <!-- FullCalendar CSS -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js'></script>
    <title>ë‚˜ì—ê²Œ ì“°ëŠ” í¸ì§€</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}?v={{ time }}">
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; }
        
        @font-face {
        font-family: 'KCC-Sonkeechung';
        src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2212@1.0/KCC-Sonkeechung.woff2') format('woff2');
        font-weight: normal;
        font-style: normal;
            }
        h1,h2,ul,button, label, p{
            font-family: 'KCC-Sonkeechung';
        }
    </style>
</head>
<body>
    <header style="position: relative;">
        <h1>A Letter To Myself</h1>
    </header>
    <!-- í–„ë²„ê±° ë²„íŠ¼ -->
    <div class="btn">
        <img src="{% static 'images/poststamp.png' %}" alt="ìš°í‘œìŠ¤í‹°ì»¤ UI" width="50px">
    </div>

    <!-- ë©”ë‰´ ë°”ê¹¥ì„ í´ë¦­í•˜ë©´ ë‹«í˜ -->
    <div class="page_cover"></div>

    <!-- ì‚¬ì´ë“œ ë©”ë‰´ -->
    <div id="menu">
        <ul class="nav">
            <li><a href="http://127.0.0.1:8000/writing">í¸ì§€ ì“°ê¸°</a></li>
            <li><a href="http://127.0.0.1:8000/letters">í¸ì§€ ëª©ë¡</a></li>
            <li><a href="http://127.0.0.1:8000/routine">í¸ì§€ ë£¨í‹´</a></li>
            {% if user.is_authenticated %}
                <a href="{% url 'commons:mypage' %}">ë§ˆì´í˜ì´ì§€</a>
            {% else %}
                <a href="{% url 'commons:login' %}">ë¡œê·¸ì¸</a>
            {% endif %}
            <li>
                {% if user.is_authenticated %}
                <a href="{% url 'commons:logout' %}">{{ user.username }} (ë¡œê·¸ì•„ì›ƒ)</a>
                
                {% endif %}
            </li>
            <li><a href="{% url 'commons:signup' %}">íšŒì›ê°€ì…</a></li>
            
        </ul>
    </div>
    
    <h2>{{ user.username }}ë‹˜ì˜ ë§ˆì´í˜ì´ì§€</h2>
    <p>í”„ë¡œí•„ ì‚¬ì§„</p>
    <p>ì´ë©”ì¼: {{ user.email }}</p>
    <p>ê°€ì… ë‚ ì§œ: {{ user.date_joined }}</p>
    
    <h2>ğŸ“Š ë‚´ê°€ ê°€ì¥ ë§ì´ ëŠë‚€ ê°ì •</h2>

    {% if most_frequent_mood %}
        <p>ğŸ§  ë¶„ì„ ê²°ê³¼: ê°€ì¥ ë§ì´ ëŠë‚€ ê°ì •ì€ <strong>{{ most_frequent_mood }}</strong> ì…ë‹ˆë‹¤.</p>
    {% else %}
        <p>ì•„ì§ ê¸°ë¡ëœ ê°ì • ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endif %}

    <h3>ğŸ“ˆ ê°ì • ê¸°ë¡ í†µê³„</h3>
    <ul>
        {% for mood in mood_counts %}
            <li style="list-style-type: none">{{ mood.mood }}: {{ mood.count }}ë²ˆ</li>
        {% endfor %}
    </ul>

<!-- ê°ì • ë°ì´í„°ë¥¼ ì‹œê°í™”í•˜ëŠ” ê·¸ë˜í”„ -->
<canvas id="moodChart"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    var ctx = document.getElementById('moodChart').getContext('2d');
    var chartData = {
        labels: [{% for mood in mood_counts %}"{{ mood.mood }}",{% endfor %}],
        datasets: [{
            label: 'ê°ì • ê¸°ë¡ íšŸìˆ˜',
            data: [{% for mood in mood_counts %}{{ mood.count }},{% endfor %}],
            backgroundColor: ['#ff9999','#66b3ff','#99ff99','#ffcc99','#ffb3e6'],
        }]
    };

    new Chart(ctx, {
        type: 'bar',
        data: chartData
    });
</script>

    <h2>ğŸ“… í¸ì§€ ë£¨í‹´ ìº˜ë¦°ë”</h2>
    <div id="calendar"></div> <!-- ìº˜ë¦°ë” í‘œì‹œ ì˜ì—­ -->

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                height: 450,
                aspectRatio: 2,
                initialView: 'dayGridMonth',
                stickyHeaderDates: true,
                ihandleWindowResize : true, // ê¸°ë³¸ê°’ | Type : Boolean
                locale: 'ko',
                events: "/api/routines/",  // âœ… Django APIì—ì„œ í¸ì§€ ë£¨í‹´ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
                eventColor: "#ff6600",  // ì´ë²¤íŠ¸ ìƒ‰ìƒ ì§€ì •
                eventClick: function(info) {  // âœ… ì´ë²¤íŠ¸ í´ë¦­ ì‹œ ìƒì„¸ ì •ë³´ í‘œì‹œ
                    alert("í¸ì§€ ë£¨í‹´: " + info.event.title + "\në‚ ì§œ: " + info.event.start.toISOString().split("T")[0]);
                
                // dateClick: function (info) {
                //     alert(info.dateStr + "ì— í¸ì§€ë¥¼ ì‘ì„±í•˜ì„¸ìš”!");
                // }
                }
                
            });
            calendar.render();
        });
        
    </script>
    
</body>
</html>
